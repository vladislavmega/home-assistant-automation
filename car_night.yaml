alias: Керування заряд авто за міською мережею (21-07)
description: >
  Вікно роботи зарядки авто з 21:00 до 06:59. О 21:00 вмикає заряд авто, якщо є
  міська мережа. У вікні 21:00–06:59 змінює стан заряду авто разом зі станом міської
  мережі. О 06:59 вимикає заряд і далі не вмикає до наступного дня.
triggers:
  - id: start_window
    at: "21:00:00"
    trigger: time
  - id: grid_change
    entity_id: switch.optika
    trigger: state
  - id: end_window
    at: "06:59:00"
    trigger: time
conditions: []
actions:
  - choose:
      - conditions:
          - condition: trigger
            id: start_window
        sequence:
          - if:
              - condition: state
                entity_id: switch.optika
                state: "on"
            then:
              - target:
                  entity_id: switch.garazhavto_socket_1
                action: switch.turn_on
            else:
              - target:
                  entity_id: switch.garazhavto_socket_1
                action: switch.turn_off
      - conditions:
          - condition: trigger
            id: grid_change
          - condition: time
            after: "21:00:00"
            before: "06:59:00"
        sequence:
          - choose:
              - conditions:
                  - condition: state
                    entity_id: switch.city_power
                    state: "on"
                sequence:
                  - target:
                      entity_id: switch.garazhavto_socket_1
                    action: switch.turn_on
            default:
              - target:
                  entity_id: switch.garazhavto_socket_1
                action: switch.turn_off
      - conditions:
          - condition: trigger
            id: end_window
        sequence:
          - target:
              entity_id: switch.garazhavto_socket_1
            action: switch.turn_off
mode: single
